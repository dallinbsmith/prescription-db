import{a as Q}from"./chunk-73AZGOVI.js";import{a as K}from"./chunk-JFUHDB3I.js";import{a as U,b as j,e as A,g as Y,h as G,i as H,k as J}from"./chunk-3PASNWI6.js";import{$ as E,Aa as q,C as f,E as _,G as u,H as w,J as m,K as z,L as V,M as S,N as v,O as a,P as o,Q as F,R as b,S as C,T as s,U as l,V as x,W as h,Y as R,Z as D,_ as T,ba as N,ca as $,da as P,ea as M,ka as O,o as y,p as k,qa as B,ra as L,t as g,u as p,xa as W,y as I,z as c}from"./chunk-XZK7E5S4.js";var tt=(n,e)=>e.id,et=n=>["/drugs",n];function nt(n,e){if(n&1){let t=b();a(0,"button",10),C("click",function(){g(t);let r=s(2);return p(r.clearSearch())}),l(1,"Clear"),o()}if(n&2){let t=s(2);u("disabled",t.loading())}}function it(n,e){if(n&1){let t=b();a(0,"div",4)(1,"div",6)(2,"input",7),E("ngModelChange",function(r){g(t);let d=s();return T(d.searchTerm,r)||(d.searchTerm=r),p(r)}),C("keyup.enter",function(){g(t);let r=s();return p(r.search())}),o(),a(3,"button",8),C("click",function(){g(t);let r=s();return p(r.search())}),l(4,"Search"),o(),_(5,nt,2,1,"button",9),o()()}if(n&2){let t=s();c(2),D("ngModel",t.searchTerm),c(),u("disabled",t.loading()),c(2),m(t.searchTerm?5:-1)}}function ot(n,e){n&1&&(a(0,"div",5),l(1,"Loading..."),o())}function rt(n,e){if(n&1&&l(0),n&2){let t=s().$implicit;h(" ",t.requires_prescription?"Yes":"No"," ")}}function at(n,e){n&1&&l(0," - ")}function lt(n,e){if(n&1&&l(0),n&2){let t=s().$implicit;h(" ",t.requires_consultation?"Yes":"No"," ")}}function ct(n,e){n&1&&l(0," - ")}function st(n,e){if(n&1&&(a(0,"a",15),l(1),o()),n&2){let t=s().$implicit;u("routerLink",$(2,et,t.drug_id)),c(),x(t.drug_name)}}function dt(n,e){n&1&&(a(0,"span",16),l(1,"Unmatched"),o())}function gt(n,e){if(n&1&&(a(0,"a",17),l(1,"View"),o()),n&2){let t=s().$implicit;u("href",t.url,I)}}function pt(n,e){n&1&&l(0," - ")}function mt(n,e){if(n&1){let t=b();a(0,"button",20),C("click",function(r){g(t);let d=s().$implicit,Z=s(2);return p(Z.toggleRegistry(d,r))}),l(1),o()}if(n&2){let t=s().$implicit,i=s(2);w("in-registry",i.isInRegistry(t.drug_id)),u("title",i.isInRegistry(t.drug_id)?"Remove from Registry":"Add to Registry"),c(),h(" ",i.isInRegistry(t.drug_id)?"\u2605":"\u2606"," ")}}function _t(n,e){if(n&1&&(a(0,"tr")(1,"td",14),l(2),o(),a(3,"td"),l(4),o(),a(5,"td"),l(6),o(),a(7,"td"),_(8,rt,1,1)(9,at,1,0),o(),a(10,"td"),_(11,lt,1,1)(12,ct,1,0),o(),a(13,"td"),_(14,st,2,4,"a",15)(15,dt,2,0,"span",16),o(),a(16,"td"),_(17,gt,2,1,"a",17)(18,pt,1,0),o(),a(19,"td",18),_(20,mt,2,4,"button",19),o()()),n&2){let t=e.$implicit,i=s(2);c(2),x(t.external_name),c(2),x(t.category||"-"),c(2),x(i.formatPrice(t.price)),c(2),m(t.requires_prescription!==null?8:9),c(3),m(t.requires_consultation!==null?11:12),c(3),m(t.drug_id&&t.drug_name?14:15),c(3),m(t.url?17:18),c(3),m(t.drug_id?20:-1)}}function ut(n,e){n&1&&(a(0,"tr")(1,"td",21),l(2,"No drugs found"),o()())}function Ct(n,e){n&1&&(a(0,"span",28),l(1,"..."),o())}function xt(n,e){if(n&1){let t=b();a(0,"button",24),C("click",function(){g(t);let r=s().$implicit,d=s(3);return p(d.goToPage(r))}),l(1),o()}if(n&2){let t=s().$implicit,i=s(3);w("active",t===i.currentPage()),u("disabled",i.loading()),c(),h(" ",t," ")}}function ft(n,e){if(n&1&&_(0,Ct,2,0,"span",28)(1,xt,2,4,"button",29),n&2){let t=e.$implicit;m(t==="..."?0:1)}}function bt(n,e){if(n&1&&(a(0,"option",27),l(1),o()),n&2){let t=e.$implicit;u("ngValue",t),c(),x(t)}}function ht(n,e){if(n&1){let t=b();a(0,"div",13)(1,"div",22),l(2),P(3,"number"),P(4,"number"),P(5,"number"),o(),a(6,"div",23)(7,"button",24),C("click",function(){g(t);let r=s(2);return p(r.previousPage())}),l(8," Previous "),o(),S(9,ft,2,1,null,null,z),a(11,"button",24),C("click",function(){g(t);let r=s(2);return p(r.nextPage())}),l(12," Next "),o()(),a(13,"div",25)(14,"label"),l(15,"Per page:"),o(),a(16,"select",26),E("ngModelChange",function(r){g(t);let d=s(2);return T(d.pageSize,r)||(d.pageSize=r),p(r)}),C("ngModelChange",function(){g(t);let r=s(2);return p(r.onPageSizeChange())}),S(17,bt,2,2,"option",27,V),o()()()}if(n&2){let t=s(2);c(2),R(" Showing ",M(3,6,t.startIndex()),"-",M(4,8,t.endIndex())," of ",M(5,10,t.total())," "),c(5),u("disabled",t.currentPage()===1||t.loading()),c(2),v(t.visiblePages()),c(2),u("disabled",t.currentPage()===t.totalPages()||t.loading()),c(5),D("ngModel",t.pageSize),c(),v(t.pageSizeOptions)}}function Pt(n,e){if(n&1&&(a(0,"div",11)(1,"table")(2,"thead")(3,"tr")(4,"th"),l(5,"Name"),o(),a(6,"th"),l(7,"Category"),o(),a(8,"th"),l(9,"Price"),o(),a(10,"th"),l(11,"Rx Required"),o(),a(12,"th"),l(13,"Consultation"),o(),a(14,"th"),l(15,"Matched Drug"),o(),a(16,"th"),l(17,"Link"),o(),F(18,"th",12),o()(),a(19,"tbody"),S(20,_t,21,8,"tr",null,tt,!1,ut,3,0,"tr"),o()()(),_(23,ht,19,12,"div",13)),n&2){let t=s();c(20),v(t.drugs()),c(3),m(t.total()>0?23:-1)}}var X=class n{route=y(W);competitorsService=y(Q);registryService=y(K);competitor="";drugs=f([]);total=f(0);totalUnfiltered=f(0);loading=f(!0);registryDrugIds=f(new Set);searchTerm="";currentPage=f(1);pageSize=50;pageSizeOptions=[25,50,100,200];totalPages=O(()=>Math.ceil(this.total()/this.pageSize)||1);startIndex=O(()=>(this.currentPage()-1)*this.pageSize+1);endIndex=O(()=>Math.min(this.currentPage()*this.pageSize,this.total()));visiblePages=O(()=>{let e=this.totalPages(),t=this.currentPage(),i=[];if(e<=7)for(let r=1;r<=e;r++)i.push(r);else{i.push(1),t>3&&i.push("...");for(let r=Math.max(2,t-1);r<=Math.min(e-1,t+1);r++)i.push(r);t<e-2&&i.push("..."),i.push(e)}return i});ngOnInit(){this.competitor=this.route.snapshot.paramMap.get("competitor")||"",this.competitor&&(this.loadInitial(),this.loadRegistryIds())}loadRegistryIds=()=>{this.registryService.getRegistry().subscribe({next:e=>{this.registryDrugIds.set(new Set(e.map(t=>t.drug_id)))}})};isInRegistry=e=>e?this.registryDrugIds().has(e):!1;toggleRegistry=(e,t)=>{t.stopPropagation(),t.preventDefault(),e.drug_id&&(this.isInRegistry(e.drug_id)?this.registryService.removeFromRegistry(e.drug_id).subscribe({next:()=>{this.registryDrugIds.update(i=>{let r=new Set(i);return r.delete(e.drug_id),r})}}):this.registryService.addToRegistry(e.drug_id).subscribe({next:()=>{this.registryDrugIds.update(i=>{let r=new Set(i);return r.add(e.drug_id),r})}}))};loadInitial=()=>{this.competitorsService.getDrugs(this.competitor,this.pageSize,0).subscribe({next:e=>{let t=e.items.filter(i=>i&&i.external_name&&i.external_name.trim());this.drugs.set(t),this.total.set(e.total),this.totalUnfiltered.set(e.total),this.loading.set(!1)},error:()=>{this.loading.set(!1)}})};loadPage=()=>{this.loading.set(!0);let e=(this.currentPage()-1)*this.pageSize,t=this.searchTerm.trim()||void 0;this.competitorsService.getDrugs(this.competitor,this.pageSize,e,t).subscribe({next:i=>{let r=i.items.filter(d=>d&&d.external_name&&d.external_name.trim());this.drugs.set(r),this.total.set(i.total),this.loading.set(!1)},error:()=>{this.loading.set(!1)}})};search=()=>{this.currentPage.set(1),this.loadPage()};clearSearch=()=>{this.searchTerm="",this.currentPage.set(1),this.loadPage()};goToPage=e=>{typeof e=="number"&&(e<1||e>this.totalPages()||(this.currentPage.set(e),this.loadPage()))};previousPage=()=>{this.currentPage()>1&&(this.currentPage.update(e=>e-1),this.loadPage())};nextPage=()=>{this.currentPage()<this.totalPages()&&(this.currentPage.update(e=>e+1),this.loadPage())};onPageSizeChange=()=>{this.currentPage.set(1),this.loadPage()};formatPrice=e=>{if(e==null)return"-";let t=typeof e=="string"?parseFloat(e):e;return isNaN(t)?"-":"$"+t.toFixed(2)};static \u0275fac=function(t){return new(t||n)};static \u0275cmp=k({type:n,selectors:[["app-competitor-drugs"]],standalone:!0,features:[N],decls:17,vars:7,consts:[[1,"competitor-drugs-page"],[1,"breadcrumb"],["routerLink","/competitors"],[1,"page-header"],[1,"search-section"],[1,"loading"],[1,"search-bar"],["type","text","placeholder","Search by name or category...",3,"ngModelChange","keyup.enter","ngModel"],[3,"click","disabled"],[1,"clear-btn",3,"disabled"],[1,"clear-btn",3,"click","disabled"],[1,"drugs-table"],[1,"action-col"],[1,"pagination"],[1,"drug-name"],[3,"routerLink"],[1,"unmatched"],["target","_blank","rel","noopener",3,"href"],[1,"action-cell"],[1,"registry-btn",3,"in-registry","title"],[1,"registry-btn",3,"click","title"],["colspan","8",1,"empty"],[1,"pagination-info"],[1,"pagination-controls"],[1,"page-btn",3,"click","disabled"],[1,"page-size"],[3,"ngModelChange","ngModel"],[3,"ngValue"],[1,"ellipsis"],[1,"page-btn",3,"active","disabled"]],template:function(t,i){t&1&&(a(0,"div",0)(1,"nav",1)(2,"a",2),l(3,"Competitors"),o(),a(4,"span"),l(5,"/"),o(),a(6,"span"),l(7),o()(),a(8,"header",3)(9,"h1"),l(10),o(),a(11,"p"),l(12),P(13,"number"),o()(),_(14,it,6,3,"div",4)(15,ot,2,0,"div",5)(16,Pt,24,2),o()),t&2&&(c(7),x(i.competitor),c(3),x(i.competitor),c(2),h("",M(13,5,i.total())," drugs found"),c(2),m(i.totalUnfiltered()>50?14:-1),c(),m(i.loading()?15:16))},dependencies:[L,B,J,G,H,U,Y,j,A,q],styles:[".competitor-drugs-page[_ngcontent-%COMP%]{max-width:1400px;margin:0 auto}.breadcrumb[_ngcontent-%COMP%]{margin-bottom:1rem;color:#6b7280;font-size:.875rem}.breadcrumb[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#4f46e5;text-decoration:none}.breadcrumb[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline}.breadcrumb[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin:0 .5rem}.page-header[_ngcontent-%COMP%]{margin-bottom:1.5rem}.page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:1.75rem;color:#1a1a2e}.page-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:.5rem 0 0;color:#6b7280}.search-section[_ngcontent-%COMP%]{background:#fff;padding:1rem 1.5rem;border-radius:8px;margin-bottom:1rem;box-shadow:0 1px 3px #0000001a}.search-bar[_ngcontent-%COMP%]{display:flex;gap:.75rem}.search-bar[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{flex:1;padding:.75rem 1rem;border:1px solid #d1d5db;border-radius:6px;font-size:1rem}.search-bar[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:none;border-color:#4f46e5}.search-bar[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:.75rem 1.5rem;background:#4f46e5;color:#fff;border:none;border-radius:6px;cursor:pointer;font-weight:500}.search-bar[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover:not(:disabled){background:#4338ca}.search-bar[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:disabled{opacity:.6}.search-bar[_ngcontent-%COMP%]   .clear-btn[_ngcontent-%COMP%]{background:#f3f4f6;color:#374151;border:1px solid #d1d5db}.search-bar[_ngcontent-%COMP%]   .clear-btn[_ngcontent-%COMP%]:hover:not(:disabled){background:#e5e7eb}.loading[_ngcontent-%COMP%]{text-align:center;padding:3rem;color:#6b7280}.drugs-table[_ngcontent-%COMP%]{background:#fff;border-radius:8px;overflow:hidden;box-shadow:0 1px 3px #0000001a}.drugs-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.drugs-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .drugs-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.75rem 1rem;text-align:left;border-bottom:1px solid #e5e7eb}.drugs-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background:#f9fafb;font-weight:600;color:#374151;font-size:.875rem}.drugs-table[_ngcontent-%COMP%]   .drug-name[_ngcontent-%COMP%]{font-weight:500;color:#1a1a2e}.drugs-table[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#4f46e5;text-decoration:none}.drugs-table[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline}.drugs-table[_ngcontent-%COMP%]   .unmatched[_ngcontent-%COMP%]{color:#f59e0b;font-size:.75rem}.drugs-table[_ngcontent-%COMP%]   .empty[_ngcontent-%COMP%]{text-align:center;color:#6b7280;padding:2rem}.drugs-table[_ngcontent-%COMP%]   .action-col[_ngcontent-%COMP%]{width:50px}.drugs-table[_ngcontent-%COMP%]   .action-cell[_ngcontent-%COMP%]{text-align:center}.drugs-table[_ngcontent-%COMP%]   .registry-btn[_ngcontent-%COMP%]{background:none;border:none;font-size:1.25rem;cursor:pointer;color:#d1d5db;padding:.25rem;line-height:1;transition:color .15s,transform .15s}.drugs-table[_ngcontent-%COMP%]   .registry-btn[_ngcontent-%COMP%]:hover{color:#f59e0b;transform:scale(1.2)}.drugs-table[_ngcontent-%COMP%]   .registry-btn.in-registry[_ngcontent-%COMP%]{color:#f59e0b}.pagination[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:1rem 1.5rem;background:#fff;border-radius:8px;margin-top:1rem;box-shadow:0 1px 3px #0000001a;flex-wrap:wrap;gap:1rem}.pagination-info[_ngcontent-%COMP%]{color:#6b7280;font-size:.875rem}.pagination-controls[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.25rem}.page-btn[_ngcontent-%COMP%]{padding:.5rem .75rem;background:#fff;border:1px solid #d1d5db;border-radius:6px;cursor:pointer;font-size:.875rem;min-width:2.5rem;transition:all .15s}.page-btn[_ngcontent-%COMP%]:hover:not(:disabled):not(.active){background:#f3f4f6;border-color:#9ca3af}.page-btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.page-btn.active[_ngcontent-%COMP%]{background:#4f46e5;border-color:#4f46e5;color:#fff}.ellipsis[_ngcontent-%COMP%]{padding:.5rem .25rem;color:#6b7280}.page-size[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.page-size[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{color:#6b7280;font-size:.875rem}.page-size[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:.5rem .75rem;border:1px solid #d1d5db;border-radius:6px;background:#fff;font-size:.875rem}@media (max-width: 768px){.page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.5rem}.search-section[_ngcontent-%COMP%]{padding:1rem}.search-bar[_ngcontent-%COMP%]{flex-direction:column}.search-bar[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .search-bar[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%}.drugs-table[_ngcontent-%COMP%]{overflow-x:auto;-webkit-overflow-scrolling:touch}.drugs-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{min-width:600px}.drugs-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .drugs-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.5rem;font-size:.8rem;white-space:nowrap}.pagination[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch;padding:1rem}.pagination[_ngcontent-%COMP%]   .pagination-info[_ngcontent-%COMP%]{text-align:center}.pagination[_ngcontent-%COMP%]   .pagination-controls[_ngcontent-%COMP%]{justify-content:center;flex-wrap:wrap}.pagination[_ngcontent-%COMP%]   .page-size[_ngcontent-%COMP%]{justify-content:center}.page-btn[_ngcontent-%COMP%]{padding:.4rem .6rem;min-width:2rem;font-size:.8rem}}"]})};export{X as CompetitorDrugsComponent};
